!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("axios"),require("validator")):"function"==typeof define&&define.amd?define(["exports","axios","validator"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["applause-reporter-common"]={},t.axios,t.validator)}(this,(function(t,e,s){"use strict";function i(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var a=i(e),n=i(s);var l;t.TestResultStatus=void 0,(l=t.TestResultStatus||(t.TestResultStatus={})).NOT_RUN="NOT_RUN",l.IN_PROGRESS="IN_PROGRESS",l.PASSED="PASSED",l.FAILED="FAILED",l.SKIPPED="SKIPPED",l.CANCELED="CANCELED",l.ERROR="ERROR";const o=t=>void 0!==t.request,r=(...t)=>{if(!Number.isInteger(t[0].productId)||t[0].productId<=0)throw new Error(`productId must be a positive integer, was: '${t[0].productId}'`);if(!o(t[0].clientConfig)){if(!n.default.isURL(t[0].clientConfig.baseUrl,{protocols:["http","https"],require_tld:!1,require_host:!0,require_protocol:!0}))throw new Error(`baseUrl is not valid HTTP/HTTPS URL, was: ${t[0].clientConfig.baseUrl}`);if(n.default.isEmpty(t[0].clientConfig.apiKey))throw new Error("apiKey is an empty string!")}};t.AutoApi=class{constructor(t){this.options=t,this.callsInFlight=0,r(t),this.client=o(t.clientConfig)?t.clientConfig:a.default.create({baseURL:t.clientConfig.baseUrl,timeout:1e4,headers:{"X-Api-Key":t.clientConfig.apiKey,"Context-Type":"application/json"},responseType:"json"})}get getCallsInFlight(){return this.callsInFlight}async startTestRun(t){this.callsInFlight+=1;try{return await this.client.post("/api/v1.0/test-run/create",{...t,sdkVersion:"js:1.0.0",productId:this.options.productId,testRailReportingEnabled:void 0!==this.options.testRailOptions,addAllTestsToPlan:this.options.testRailOptions?.addAllTestsToPlan,testRailProjectId:this.options.testRailOptions?.projectId,testRailSuiteId:this.options.testRailOptions?.suiteId,testRailPlanName:this.options.testRailOptions?.planName,testRailRunName:this.options.testRailOptions?.runName,overrideTestRailRunNameUniqueness:this.options.testRailOptions?.overrideTestRailRunUniqueness})}finally{this.callsInFlight-=1}}async endTestRun(t){this.callsInFlight+=1;try{return await this.client.delete(`/api/v3.0/driver-session/${t}?sessionStatus=COMPLETE`)}finally{this.callsInFlight-=1}}async startTestCase(t){this.callsInFlight+=1;try{return await this.client.post("/api/v1.0/test-result/create-result",t)}finally{this.callsInFlight-=1}}async submitTestResult(t){this.callsInFlight+=1;try{await this.client.post("/api/v1.0/test-result",t)}finally{this.callsInFlight-=1}}async getProviderSessionLinks(t){this.callsInFlight+=1;try{const e=t.filter((t=>t));return await this.client.post("/api/v1.0/test-result/provider-info",e)}finally{this.callsInFlight-=1}}async sendSdkHeartbeat(t){this.callsInFlight+=1;try{return await this.client.post(`/api/v2.0/sdk-heartbeat?testRunId=${t}`)}finally{this.callsInFlight-=1}}},t.TestRunHeartbeatService=class{constructor(t,e){this.testRunId=t,this.autoApi=e,this.enabled=!1}async start(){await this.end(),this.enabled=!0,this.scheduleNextHeartbeat()}scheduleNextHeartbeat(){this.enabled&&(this.nextHeartbeat=new Promise((t=>setTimeout(t,5e3))).then((async()=>await this.sendHeartbeat())))}async sendHeartbeat(){await this.autoApi.sendSdkHeartbeat(this.testRunId),this.scheduleNextHeartbeat()}async end(){void 0!==this.nextHeartbeat&&(this.enabled=!1,console.debug("Ending Applause SDK Heartbeat"),await this.nextHeartbeat,console.debug("Applause SDK Heartbeat Ended Successfully")),this.nextHeartbeat=void 0}},t._validateCtorParams=r,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=index.min.js.map
