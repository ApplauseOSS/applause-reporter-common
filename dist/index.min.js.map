{"version":3,"file":"index.min.js","sources":["../src/version.ts","../src/config.ts","../src/auto-api.ts","../src/dto.ts","../src/email/inbox.ts","../src/heartbeat.ts","../src/reporter.ts","../src/email-helper.ts"],"sourcesContent":["export const API_VERSION = '1.0.0';\n//# sourceMappingURL=version.js.map","import { existsSync, readFileSync } from 'fs';\nimport path from 'path';\nimport Validator from 'validator';\nconst validator = Validator.default;\nexport const DEFAULT_URL = 'https://prod-auto-api.cloud.applause.com/';\n// Loads the configuration\nexport function loadConfig(loadOptions) {\n    // Setup the initial config with any default properties\n    let config = {\n        baseUrl: DEFAULT_URL,\n    };\n    // Load properties from the provided config file\n    if (loadOptions !== undefined && loadOptions.configFile !== undefined) {\n        config = overrideConfig(config, loadConfigFromFile(path.join(process.cwd(), loadOptions.configFile)));\n    }\n    else {\n        // Override from the default config file\n        config = overrideConfig(config, loadConfigFromFile());\n    }\n    // Then load in the file override properties\n    if (loadOptions !== undefined && loadOptions.properties !== undefined) {\n        config = overrideConfig(config, loadOptions.properties);\n    }\n    if (!isComplete(config)) {\n        throw new Error('Config is not complete');\n    }\n    // We know that the config is complete, so we can cast\n    const finalConfig = config;\n    validateConfig(finalConfig);\n    return finalConfig;\n}\nexport function overrideConfig(config, overrides) {\n    return Object.assign({}, config, Object.fromEntries(Object.entries(overrides || {}).filter(([_, v]) => v !== undefined)));\n}\nexport function isComplete(config) {\n    return (config.baseUrl !== undefined &&\n        config.apiKey !== undefined &&\n        config.productId !== undefined);\n}\nexport function loadConfigFromFile(configFile) {\n    const configFilePath = configFile || process.cwd() + '/applause.json';\n    if (!existsSync(configFilePath)) {\n        return {};\n    }\n    const fileCotents = readFileSync(configFilePath, 'utf8');\n    return JSON.parse(fileCotents);\n}\nexport function validateConfig(config) {\n    if (!Number.isInteger(config.productId) || config.productId <= 0) {\n        throw new Error(`productId must be a positive integer, was: '${config.productId}'`);\n    }\n    if (!validator.isURL(config.baseUrl, {\n        protocols: ['http', 'https'],\n        require_tld: false,\n        allow_query_components: false,\n        disallow_auth: true,\n        allow_fragments: false,\n        allow_protocol_relative_urls: false,\n        allow_trailing_dot: false,\n        require_host: true,\n        require_protocol: true,\n    })) {\n        throw new Error(`baseUrl is not valid HTTP/HTTPS URL, was: ${config.baseUrl}`);\n    }\n    if (validator.isEmpty(config.apiKey)) {\n        throw new Error('apiKey is an empty string!');\n    }\n}\nexport function validatePartialConfig(config) {\n    if (config.productId !== undefined &&\n        (!Number.isInteger(config.productId) || config.productId <= 0)) {\n        throw new Error(`productId must be a positive integer, was: '${config.productId}'`);\n    }\n}\n//# sourceMappingURL=config.js.map","import axios from 'axios';\nimport { API_VERSION } from './version.ts';\nimport { validateConfig } from './config.ts';\nexport class AutoApi {\n    options;\n    client;\n    callsInFlight;\n    /**\n     * tracks number of HTTP calls in progress, used by reporters that want to know when our async work is finished\n     */\n    get getCallsInFlight() {\n        return this.callsInFlight;\n    }\n    constructor(options) {\n        this.options = options;\n        this.callsInFlight = 0;\n        validateConfig(options);\n        this.client = axios.create({\n            baseURL: options.baseUrl,\n            timeout: 10000,\n            headers: {\n                'X-Api-Key': options.apiKey,\n                'Context-Type': 'application/json',\n            },\n            responseType: 'json',\n        });\n        this.client.interceptors.response.use(function (response) {\n            return response;\n        }, function (error) {\n            // log and rethrow\n            const errText = \n            // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n            error.data !== undefined\n                ? // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n                    error.data\n                : // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n                    `error-code [${error.response.status}] with error [${error.response.statusText}]`;\n            console.error(`Auto-Api returned ${errText}`);\n            return Promise.reject(error);\n        });\n    }\n    async startTestRun(info) {\n        this.callsInFlight += 1;\n        try {\n            return await this.client.post('/api/v1.0/test-run/create', {\n                // Provided params\n                ...info,\n                // API Version\n                sdkVersion: `js:${API_VERSION}`,\n                // Copy over the product id\n                productId: this.options.productId,\n                // Copy over test rail parameters\n                testRailReportingEnabled: this.options.testRailOptions !== undefined,\n                addAllTestsToPlan: this.options.testRailOptions?.addAllTestsToPlan,\n                testRailProjectId: this.options.testRailOptions?.projectId,\n                testRailSuiteId: this.options.testRailOptions?.suiteId,\n                testRailPlanName: this.options.testRailOptions?.planName,\n                testRailRunName: this.options.testRailOptions?.runName,\n                overrideTestRailRunNameUniqueness: this.options.testRailOptions?.overrideTestRailRunUniqueness,\n            });\n        }\n        finally {\n            this.callsInFlight -= 1;\n        }\n    }\n    async endTestRun(testRunId) {\n        this.callsInFlight += 1;\n        try {\n            return await this.client.delete(`/api/v1.0/test-run/${testRunId}?endingStatus=COMPLETE`);\n        }\n        finally {\n            this.callsInFlight -= 1;\n        }\n    }\n    async startTestCase(params) {\n        this.callsInFlight += 1;\n        try {\n            const res = await this.client.post('/api/v1.0/test-result/create-result', params);\n            return res;\n        }\n        finally {\n            this.callsInFlight -= 1;\n        }\n    }\n    async submitTestCaseResult(params) {\n        this.callsInFlight += 1;\n        try {\n            await this.client.post('/api/v1.0/test-result', params);\n        }\n        finally {\n            this.callsInFlight -= 1;\n        }\n    }\n    async getProviderSessionLinks(resultIds) {\n        this.callsInFlight += 1;\n        try {\n            // this filters out falsy values (null, undefined, 0)\n            const validIds = resultIds.filter(id => id);\n            return await this.client.post('/api/v1.0/test-result/provider-info', validIds);\n        }\n        finally {\n            this.callsInFlight -= 1;\n        }\n    }\n    async sendSdkHeartbeat(testRunId) {\n        this.callsInFlight += 1;\n        try {\n            // this filters out falsy values (null, undefined, 0)\n            return await this.client.post('/api/v2.0/sdk-heartbeat', {\n                testRunId: testRunId,\n            });\n        }\n        finally {\n            this.callsInFlight -= 1;\n        }\n    }\n    async getEmailAddress(emailPrefix) {\n        this.callsInFlight += 1;\n        try {\n            // this filters out falsy values (null, undefined, 0)\n            return await this.client.get(`/api/v1.0/email/get-address?prefix=${emailPrefix}`);\n        }\n        finally {\n            this.callsInFlight -= 1;\n        }\n    }\n    async getEmailContent(request) {\n        this.callsInFlight += 1;\n        try {\n            // this filters out falsy values (null, undefined, 0)\n            return await this.client.post('/api/v1.0/email/download-email', request);\n        }\n        finally {\n            this.callsInFlight -= 1;\n        }\n    }\n}\n//# sourceMappingURL=auto-api.js.map","/**\n * Enum representing a test result's status\n */\nexport var TestResultStatus;\n(function (TestResultStatus) {\n    TestResultStatus[\"NOT_RUN\"] = \"NOT_RUN\";\n    TestResultStatus[\"IN_PROGRESS\"] = \"IN_PROGRESS\";\n    TestResultStatus[\"PASSED\"] = \"PASSED\";\n    TestResultStatus[\"FAILED\"] = \"FAILED\";\n    TestResultStatus[\"SKIPPED\"] = \"SKIPPED\";\n    TestResultStatus[\"CANCELED\"] = \"CANCELED\";\n    TestResultStatus[\"ERROR\"] = \"ERROR\";\n})(TestResultStatus || (TestResultStatus = {}));\n//# sourceMappingURL=dto.js.map","import { simpleParser } from 'mailparser';\nexport class Inbox {\n    emailAddress;\n    autoApi;\n    constructor(emailAddress, autoApi) {\n        this.emailAddress = emailAddress;\n        this.autoApi = autoApi;\n    }\n    async getEmail() {\n        const res = await this.autoApi.getEmailContent({\n            emailAddress: this.emailAddress,\n        });\n        return await simpleParser(res.data);\n    }\n}\n//# sourceMappingURL=inbox.js.map","export class TestRunHeartbeatService {\n    testRunId;\n    autoApi;\n    enabled = false;\n    nextHeartbeat;\n    constructor(testRunId, autoApi) {\n        this.testRunId = testRunId;\n        this.autoApi = autoApi;\n    }\n    async start() {\n        // End the current heartbeat if it has started\n        await this.end();\n        // Set up va new interval\n        this.enabled = true;\n        this.scheduleNextHeartbeat();\n    }\n    isEnabled() {\n        return this.enabled;\n    }\n    scheduleNextHeartbeat() {\n        if (!this.enabled) {\n            return;\n        }\n        this.nextHeartbeat = new Promise(resolve => setTimeout(resolve, 5000)).then(() => this.sendHeartbeat());\n    }\n    async sendHeartbeat() {\n        console.log('Sending heartbeat');\n        await this.autoApi.sendSdkHeartbeat(this.testRunId);\n        console.log('Heartbeat sent');\n        this.scheduleNextHeartbeat();\n    }\n    async end() {\n        if (this.nextHeartbeat !== undefined) {\n            this.enabled = false;\n            console.debug('Ending Applause SDK Heartbeat');\n            await this.nextHeartbeat;\n            console.debug('Applause SDK Heartbeat Ended Successfully');\n        }\n        this.nextHeartbeat = undefined;\n    }\n}\n//# sourceMappingURL=heartbeat.js.map","import { writeFileSync } from 'fs';\nimport { AutoApi } from './auto-api.ts';\nimport { TestRunHeartbeatService } from './heartbeat.ts';\nimport { join as pathJoin } from 'path';\nexport class ApplauseReporter {\n    autoApi;\n    initializer;\n    reporter;\n    runStarted = false;\n    runFinished = false;\n    constructor(config) {\n        this.autoApi = new AutoApi(config);\n        this.initializer = new RunInitializer(this.autoApi);\n    }\n    runnerStart(tests) {\n        this.reporter = this.initializer.initializeRun(tests);\n        void this.reporter.then(() => {\n            this.runStarted = true;\n        });\n    }\n    startTestCase(id, testCaseName, params) {\n        if (this.reporter === undefined) {\n            throw new Error('Cannot start a test case for a run that was never initialized');\n        }\n        void this.reporter.then(reporter => reporter.startTestCase(id, testCaseName, params));\n    }\n    submitTestCaseResult(id, status, params) {\n        if (this.reporter === undefined) {\n            throw new Error('Cannot submit test case result for a run that was never initialized');\n        }\n        void this.reporter.then(reporter => reporter.submitTestCaseResult(id, status, params));\n    }\n    async runnerEnd() {\n        if (this.reporter === undefined) {\n            throw new Error('Cannot end a run that was never initialized');\n        }\n        await this.reporter\n            .then(reporter => reporter.runnerEnd())\n            .then(() => (this.runFinished = true));\n    }\n    isSynchronized() {\n        // Verify the run is not yet started or it has ended, and all calls made to the applause api have finished\n        return ((!this.runStarted || (this.runStarted && this.runFinished)) &&\n            this.autoApi.getCallsInFlight == 0);\n    }\n}\nexport class RunInitializer {\n    autoApi;\n    constructor(autoApi) {\n        this.autoApi = autoApi;\n    }\n    async initializeRun(tests) {\n        const cleanedTests = tests\n            ?.map(parseTestCaseName)\n            .map(parsed => parsed.testCaseName.trim());\n        const testRunCreateResponse = await this.autoApi.startTestRun({\n            tests: cleanedTests || [],\n        });\n        if (testRunCreateResponse.status < 200 ||\n            testRunCreateResponse.status > 300) {\n            throw new Error('Unable to create test run');\n        }\n        const runId = testRunCreateResponse.data.runId;\n        console.log('Test Run %d initialized', runId);\n        const heartbeatService = new TestRunHeartbeatService(runId, this.autoApi);\n        await heartbeatService.start();\n        return new RunReporter(this.autoApi, runId, heartbeatService);\n    }\n}\nexport class RunReporter {\n    autoApi;\n    testRunId;\n    heartbeatService;\n    uidToResultIdMap = {};\n    resultSubmissionMap = {};\n    constructor(autoApi, testRunId, heartbeatService) {\n        this.autoApi = autoApi;\n        this.testRunId = testRunId;\n        this.heartbeatService = heartbeatService;\n    }\n    startTestCase(id, testCaseName, params) {\n        const parsedTestCase = parseTestCaseName(testCaseName);\n        this.uidToResultIdMap[id] = this.autoApi\n            .startTestCase({\n            testCaseName: parsedTestCase.testCaseName,\n            testCaseId: parsedTestCase.testRailTestCaseId,\n            itwTestCaseId: parsedTestCase.applauseTestCaseId,\n            testRunId: this.testRunId,\n            // If the additional params provides either test case id, it will override the parsed value we set above\n            ...Object.fromEntries(Object.entries(params || {}).filter(([_, v]) => v !== undefined)),\n        })\n            .then(res => {\n            return res.data.testResultId;\n        });\n    }\n    submitTestCaseResult(id, status, params) {\n        this.resultSubmissionMap[id] = this.uidToResultIdMap[id]?.then(resultId => this.autoApi.submitTestCaseResult({\n            status: status,\n            testResultId: resultId,\n            ...params,\n        }));\n    }\n    async runnerEnd() {\n        // Wait for all results to be created\n        const resultIds = (await Promise.all(Object.values(this.uidToResultIdMap))) || [];\n        // Wait for the results to be submitted\n        void (await Promise.all(Object.values(this.resultSubmissionMap)));\n        // Wait the heartbeat to be ended\n        void (await this.heartbeatService.end());\n        void (await this.autoApi.endTestRun(this.testRunId));\n        // Fetch the provider session asset links and save them off to a file\n        const resp = await this.autoApi.getProviderSessionLinks(resultIds);\n        const jsonArray = resp.data || [];\n        if (jsonArray.length > 0) {\n            console.info(JSON.stringify(jsonArray));\n            // this is the wdio.conf outputDir\n            const outputPath = '.';\n            writeFileSync(pathJoin(outputPath, 'providerUrls.txt'), JSON.stringify(jsonArray, null, 1));\n        }\n    }\n}\nconst TEST_RAIL_CASE_ID_PREFIX = 'TestRail-';\nconst APPLAUSE_CASE_ID_PREFIX = 'Applause-';\nfunction parseTestCaseName(testCaseName) {\n    // Split the name on spaces. We will reassemble after parsing out the other ids\n    const tokens = testCaseName.split(' ');\n    let testRailTestCaseId;\n    let applauseTestCaseId;\n    tokens.forEach(token => {\n        if (token?.startsWith(TEST_RAIL_CASE_ID_PREFIX)) {\n            if (testRailTestCaseId !== undefined) {\n                console.warn('Multiple TestRail case ids detected in testCase name');\n            }\n            testRailTestCaseId = token.substring(TEST_RAIL_CASE_ID_PREFIX.length);\n        }\n        else if (token?.startsWith(APPLAUSE_CASE_ID_PREFIX)) {\n            if (applauseTestCaseId !== undefined) {\n                console.warn('Multiple Applause case ids detected in testCase name');\n            }\n            applauseTestCaseId = token.substring(APPLAUSE_CASE_ID_PREFIX.length);\n        }\n    });\n    return {\n        applauseTestCaseId,\n        testRailTestCaseId,\n        testCaseName: tokens\n            .filter(token => token !== `${TEST_RAIL_CASE_ID_PREFIX}${testRailTestCaseId || ''}`)\n            .filter(token => token !== `${APPLAUSE_CASE_ID_PREFIX}${applauseTestCaseId || ''}`)\n            .join(' ')\n            .trim(),\n    };\n}\n//# sourceMappingURL=reporter.js.map","import { Inbox } from './email/inbox.ts';\nexport class EmailHelper {\n    autoApi;\n    constructor(autoApi) {\n        this.autoApi = autoApi;\n    }\n    async getInbox(emailPrefix) {\n        const generatedAddress = (await this.autoApi.getEmailAddress(emailPrefix)).data.emailAddress;\n        return new Inbox(generatedAddress, this.autoApi);\n    }\n}\nexport * from './email/attachment.ts';\nexport * from './email/inbox.ts';\n//# sourceMappingURL=email-helper.js.map"],"names":["validator","Validator","default","DEFAULT_URL","overrideConfig","config","overrides","Object","assign","fromEntries","entries","filter","_","v","undefined","isComplete","baseUrl","apiKey","productId","loadConfigFromFile","configFile","configFilePath","process","cwd","existsSync","fileCotents","readFileSync","JSON","parse","validateConfig","Number","isInteger","Error","isURL","protocols","require_tld","allow_query_components","disallow_auth","allow_fragments","allow_protocol_relative_urls","allow_trailing_dot","require_host","require_protocol","isEmpty","AutoApi","options","client","callsInFlight","getCallsInFlight","this","constructor","axios","create","baseURL","timeout","headers","responseType","interceptors","response","use","error","errText","data","status","statusText","console","Promise","reject","startTestRun","info","post","sdkVersion","testRailReportingEnabled","testRailOptions","addAllTestsToPlan","testRailProjectId","projectId","testRailSuiteId","suiteId","testRailPlanName","planName","testRailRunName","runName","overrideTestRailRunNameUniqueness","overrideTestRailRunUniqueness","endTestRun","testRunId","delete","startTestCase","params","submitTestCaseResult","getProviderSessionLinks","resultIds","validIds","id","sendSdkHeartbeat","getEmailAddress","emailPrefix","get","getEmailContent","request","TestResultStatus","exports","Inbox","emailAddress","autoApi","getEmail","res","simpleParser","TestRunHeartbeatService","enabled","nextHeartbeat","start","end","scheduleNextHeartbeat","isEnabled","resolve","setTimeout","then","sendHeartbeat","log","debug","RunInitializer","initializeRun","tests","cleanedTests","map","parseTestCaseName","parsed","testCaseName","trim","testRunCreateResponse","runId","heartbeatService","RunReporter","uidToResultIdMap","resultSubmissionMap","parsedTestCase","testCaseId","testRailTestCaseId","itwTestCaseId","applauseTestCaseId","testResultId","resultId","runnerEnd","all","values","jsonArray","length","stringify","outputPath","writeFileSync","pathJoin","join","TEST_RAIL_CASE_ID_PREFIX","APPLAUSE_CASE_ID_PREFIX","tokens","split","forEach","token","startsWith","warn","substring","initializer","reporter","runStarted","runFinished","runnerStart","isSynchronized","getInbox","generatedAddress","loadOptions","path","properties","finalConfig"],"mappings":"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"}